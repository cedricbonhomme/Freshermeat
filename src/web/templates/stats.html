{% extends "layout.html" %}}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-8">
            <h2>Licenses distribution</h2>
            <canvas id="licenses-pie-chart"></canvas>
        </div>
        <div class="col-4">
            <h2>Explore tags</h2>
            <div id="tags-cloud"></div>
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
    var colors = [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ];
    $.ajax({
        url: "{{ url_for('stats_bp.licenses',) }}",
        dataType: "json",
        contentType: "application/json",
        success: function(licenses) {
            var ctx = document.getElementById("licenses-pie-chart").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(licenses),
                    datasets: [{
                        data: Object.values(licenses),
                        borderWidth: 1,
                        backgroundColor:colors
                    }]
                },
            });
        }
    });

    $.ajax({
        url: "{{ url_for('stats_bp.tags',) }}",
        dataType: "json",
        contentType: "application/json",
        success: function(tags) {
            var max = Object.values(tags).reduce(function(a,b) {
                return Math.max(a, b);
            });
            for (tag in tags) {
                $("#tags-cloud").append('<a href="/projects/?tag=' +
                                    tag + '"><font size=' +
                                    Math.min(1 + (tags[tag] * 7) / max, 7) +
                                    "' id='" + tag + "'>" +
                                    tag + "</font></a>&nbsp;");
            }
        }
    });
});
</script>
{% endblock %}
